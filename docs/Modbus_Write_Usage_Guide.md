# Modbus 写入功能使用指南

## 概述
更新后的 `onWriteRegister` 函数现在支持写入单个值和多个值，提供了更灵活的 Modbus 写入操作。

## 支持的寄存器类型
1. **线圈 (Coils)**
   - 单个线圈: `writeSingleCoil`
   - 多个线圈: `writeMultipleCoils`

2. **保持寄存器 (Holding Registers)**
   - 单个寄存器: `writeSingleRegister`
   - 多个寄存器: `writeMultipleRegisters`

## 输入格式

### 地址格式
- 输入起始地址，例如: `100`, `0`, `1000`

### 值格式

#### 单个值
- **线圈**: `1`, `0`, `true`, `false`, `on`, `off`
- **寄存器**: `12345` (0-65535)

#### 多个值 (用逗号、分号或空格分隔)
- **线圈**: `1,0,1,1,0` 或 `true false on off true`
- **寄存器**: `100,200,300` 或 `1000; 2000; 3000` 或 `500 600 700`

## 使用示例

### 写入单个线圈
```
寄存器类型: 线圈
地址: 100
值: 1
结果: 在地址100写入ON状态
```

### 写入多个线圈
```
寄存器类型: 线圈
地址: 100
值: 1,0,1,0,1
结果: 在地址100-104写入: ON,OFF,ON,OFF,ON
```

### 写入单个保持寄存器
```
寄存器类型: 保持寄存器
地址: 1000
值: 12345
结果: 在地址1000写入值12345
```

### 写入多个保持寄存器
```
寄存器类型: 保持寄存器
地址: 1000
值: 100,200,300,400,500
结果: 在地址1000-1004分别写入: 100,200,300,400,500
```

## 限制
- 多个寄存器写入最多支持123个寄存器 (Modbus协议限制)
- 多个线圈写入最多支持1968个线圈 (Modbus协议限制)
- 寄存器值范围: 0-65535
- 线圈值: 0/1 或 true/false 或 on/off

## 错误处理
- 自动验证输入格式
- 显示详细的错误消息
- 记录操作日志
- 区分单个值和多个值写入的错误类型

## 日志输出示例
```
[14:30:15] 成功: 写入单个寄存器 地址:1000 值:12345
[14:31:20] 成功: 写入多个寄存器 [1000:100, 1001:200, 1002:300]
[14:32:10] 成功: 写入多个线圈 [100:ON, 101:OFF, 102:ON, 103:OFF]
[14:33:05] 失败: 写入多个寄存器 [1000:100, 1001:200] - 错误: 设备无响应
```

## 性能考虑
- 单个值写入响应更快
- 多个值写入减少通信开销，但传输时间稍长
- 建议批量写入相邻的寄存器以提高效率
