# Libmodbus åº“æ–‡æ¡£

## æ¦‚è¿°

æ¬¢è¿ä½¿ç”¨ Libmodbus åº“æ–‡æ¡£ä¸­å¿ƒã€‚æœ¬åº“æä¾›äº†å®Œæ•´çš„ Modbus RTU/TCP é€šä¿¡è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å«åŸºç¡€é€šä¿¡ã€æ€§èƒ½ä¼˜åŒ–ã€è¯Šæ–­å·¥å…·ç­‰åŠŸèƒ½ã€‚

## ğŸ“š æ–‡æ¡£ç›®å½•

### æ ¸å¿ƒç»„ä»¶

| æ–‡æ¡£ | æè¿° | ä¸»è¦åŠŸèƒ½ |
|------|------|----------|
| [ğŸ“¡ modbus.md](modbus.md) | æ ¸å¿ƒ Modbus åº“æ–‡æ¡£ | åŸºç¡€æ•°æ®ç±»å‹ã€é”™è¯¯å¤„ç†ã€æ ¸å¿ƒAPI |
| [ğŸ”§ modbusmanager.md](modbusmanager.md) | Modbus ç®¡ç†å™¨æ–‡æ¡£ | è¿æ¥ç®¡ç†ã€æ•°æ®è¯»å†™ã€ä¸²å£è¯Šæ–­ |
| [ğŸ“Š modbus_rw_manager.md](modbus_rw_manager.md) | è¯»å†™ç®¡ç†å™¨æ–‡æ¡£ | é«˜çº§è¯»å†™æ“ä½œã€æ‰¹é‡å¤„ç†ã€é™æ€å·¥å…· |

### é€šä¿¡åè®®

| æ–‡æ¡£ | æè¿° | é€‚ç”¨åœºæ™¯ |
|------|------|----------|
| [ğŸ”Œ modbus-rtu.md](modbus-rtu.md) | RTU é€šä¿¡åè®®æ–‡æ¡£ | ä¸²å£é€šä¿¡ã€RS485 æ€»çº¿ |
| [ğŸŒ modbus-tcp.md](modbus-tcp.md) | TCP/IP é€šä¿¡åè®®æ–‡æ¡£ | ç½‘ç»œé€šä¿¡ã€ä»¥å¤ªç½‘è¿æ¥ |

### æ€§èƒ½ä¼˜åŒ–

| æ–‡æ¡£ | æè¿° | ä¼˜åŒ–ç‰¹æ€§ |
|------|------|----------|
| [âš¡ modbus_performance.md](modbus_performance.md) | æ€§èƒ½ä¼˜åŒ–ç»„ä»¶æ–‡æ¡£ | è¿æ¥æ± ã€ç¼“å­˜ã€å¼‚æ­¥æ“ä½œã€æ™ºèƒ½é‡è¿ |
| [ğŸš€ optimized_modbus_manager.md](optimized_modbus_manager.md) | ä¼˜åŒ–ç®¡ç†å™¨æ–‡æ¡£ | ç»¼åˆæ€§èƒ½ä¼˜åŒ–ã€ç»Ÿä¸€é«˜çº§API |
| [ğŸ“ˆ modbus_benchmark.md](modbus_benchmark.md) | æ€§èƒ½åŸºå‡†æµ‹è¯•æ–‡æ¡£ | æ€§èƒ½æµ‹è¯•å·¥å…·ã€åŸºå‡†æµ‹è¯•ã€æ€§èƒ½åˆ†æ |

### å·¥å…·å’Œè¾…åŠ©

| æ–‡æ¡£ | æè¿° | ç”¨é€” |
|------|------|------|
| [â„¹ï¸ modbus-version.md](modbus-version.md) | ç‰ˆæœ¬ä¿¡æ¯æ–‡æ¡£ | ç‰ˆæœ¬æ£€æŸ¥ã€å…¼å®¹æ€§éªŒè¯ |

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. åŸºç¡€ Modbus é€šä¿¡

```cpp
#include "modbusmanager.h"

// åˆ›å»ºç®¡ç†å™¨
ModbusManager* manager = new ModbusManager(this);

// RTU è¿æ¥
bool success = manager->connectRTU("COM1", 9600, 8, 'N', 1);
if (success) {
    // è®¾ç½®ä»æœºåœ°å€
    manager->setSlaveID(1);
    
    // è¯»å–ä¿æŒå¯„å­˜å™¨
    QVector<quint16> values;
    bool readSuccess = manager->readHoldingRegisters(0, 10, values);
    if (readSuccess) {
        qDebug() << "è¯»å–æˆåŠŸï¼š" << values;
    }
}
```

### 2. é«˜æ€§èƒ½ Modbus é€šä¿¡

```cpp
#include "optimized_modbus_manager.h"

// åˆ›å»ºä¼˜åŒ–ç®¡ç†å™¨
OptimizedModbusManager* manager = new OptimizedModbusManager(this);

// é…ç½®ä¼˜åŒ–å‚æ•°
OptimizedModbusManager::OptimizationConfig config;
config.cacheEnabled = true;
config.asyncEnabled = true;
config.autoReconnectEnabled = true;
manager->setOptimizationConfig(config);

// è¿æ¥è®¾å¤‡
bool success = manager->connectDevice("device1", "192.168.1.100:502", 1);

// å¼‚æ­¥è¯»å–
QString operationId = manager->readHoldingRegistersAsync("device1", 0, 10,
    [](bool success, const QVector<quint16>& values) {
        if (success) {
            qDebug() << "å¼‚æ­¥è¯»å–æˆåŠŸï¼š" << values;
        }
    });
```

### 3. ä¸²å£è¯Šæ–­

```cpp
#include "modbusmanager.h"

// è·å–å¯ç”¨ä¸²å£
QStringList ports = ModbusManager::getAvailablePorts();
qDebug() << "å¯ç”¨ä¸²å£ï¼š" << ports;

// æµ‹è¯•ä¸²å£è¿æ¥
bool canConnect = ModbusManager::testPortConnection("COM1", 9600, 8, 'N', 1);
qDebug() << "ä¸²å£æµ‹è¯•ï¼š" << (canConnect ? "æˆåŠŸ" : "å¤±è´¥");

// ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š
QString report = ModbusManager::generateDiagnosticReport();
qDebug() << "è¯Šæ–­æŠ¥å‘Šï¼š\n" << report;
```

## ğŸ“‹ åŠŸèƒ½ç‰¹æ€§

### âœ… æ ¸å¿ƒåŠŸèƒ½
- **å¤šåè®®æ”¯æŒ**ï¼šRTU (ä¸²å£) å’Œ TCP/IP ä¸¤ç§é€šä¿¡åè®®
- **å®Œæ•´æ•°æ®ç±»å‹**ï¼šæ”¯æŒçº¿åœˆã€ç¦»æ•£è¾“å…¥ã€è¾“å…¥å¯„å­˜å™¨ã€ä¿æŒå¯„å­˜å™¨
- **å¼‚å¸¸å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯æ£€æµ‹å’Œå¼‚å¸¸å¤„ç†æœºåˆ¶
- **è°ƒè¯•æ”¯æŒ**ï¼šå†…ç½®è°ƒè¯•æ¨¡å¼å’Œè¯¦ç»†æ—¥å¿—

### âœ… æ€§èƒ½ä¼˜åŒ–
- **è¿æ¥æ± ç®¡ç†**ï¼šè‡ªåŠ¨ç®¡ç†å’Œå¤ç”¨è¿æ¥ï¼Œå‡å°‘è¿æ¥å¼€é”€
- **æ™ºèƒ½ç¼“å­˜**ï¼šç¼“å­˜è¯»å–ç»“æœï¼Œé¿å…é‡å¤è¯·æ±‚
- **å¼‚æ­¥æ“ä½œ**ï¼šéé˜»å¡å¼‚æ­¥ I/O æ“ä½œ
- **æ‰¹é‡å¤„ç†**ï¼šåˆå¹¶å¤šä¸ªè¯·æ±‚ï¼Œæé«˜é€šä¿¡æ•ˆç‡
- **æ™ºèƒ½é‡è¿**ï¼šè‡ªåŠ¨æ£€æµ‹è¿æ¥çŠ¶æ€å¹¶æ™ºèƒ½é‡è¿

### âœ… è¯Šæ–­å·¥å…·
- **ä¸²å£æ£€æµ‹**ï¼šè‡ªåŠ¨æ£€æµ‹ç³»ç»Ÿå¯ç”¨ä¸²å£
- **è¿æ¥æµ‹è¯•**ï¼šæµ‹è¯•ä¸²å£è¿æ¥å‚æ•°å’Œé€šä¿¡çŠ¶æ€
- **è®¾å¤‡æ‰«æ**ï¼šæ‰«æ Modbus æ€»çº¿ä¸Šçš„è®¾å¤‡
- **æ•…éšœè¯Šæ–­**ï¼šæä¾›è¯¦ç»†çš„æ•…éšœè¯Šæ–­å’Œè§£å†³å»ºè®®
- **æ€§èƒ½ç›‘æ§**ï¼šå®æ—¶ç›‘æ§é€šä¿¡æ€§èƒ½å’Œç³»ç»Ÿå¥åº·çŠ¶æ€

### âœ… å¼€å‘å‹å¥½
- **Qt é›†æˆ**ï¼šå®Œå…¨åŸºäº Qt æ¡†æ¶ï¼Œæ”¯æŒä¿¡å·æ§½æœºåˆ¶
- **çº¿ç¨‹å®‰å…¨**ï¼šå†…ç½®çº¿ç¨‹å®‰å…¨ä¿æŠ¤ï¼Œæ”¯æŒå¤šçº¿ç¨‹ä½¿ç”¨
- **é…ç½®æŒä¹…åŒ–**ï¼šæ”¯æŒé…ç½®çš„ä¿å­˜å’ŒåŠ è½½
- **ä¸°å¯Œç¤ºä¾‹**ï¼šæä¾›è¯¦ç»†çš„ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µ

## ğŸ”§ ç³»ç»Ÿè¦æ±‚

### åŸºç¡€è¦æ±‚
- **æ“ä½œç³»ç»Ÿ**ï¼šWindows 7+, Linux, macOS
- **Qt ç‰ˆæœ¬**ï¼šQt 5.12+ æˆ– Qt 6.x
- **ç¼–è¯‘å™¨**ï¼šMSVC 2017+, GCC 7+, Clang 6+
- **CMake**ï¼š3.16+ ï¼ˆå¦‚æœä½¿ç”¨ CMake æ„å»ºï¼‰

### ä¾èµ–åº“
- **libmodbus**ï¼šæ ¸å¿ƒ Modbus C åº“
- **Qt5Core**ï¼šQt æ ¸å¿ƒåº“
- **Qt5Network**ï¼šç½‘ç»œé€šä¿¡åº“ï¼ˆTCP åè®®ï¼‰
- **Qt5SerialPort**ï¼šä¸²å£é€šä¿¡åº“ï¼ˆRTU åè®®ï¼‰

## ğŸ“– ä½¿ç”¨æŒ‡å—

### é€‰æ‹©åˆé€‚çš„ç»„ä»¶

| éœ€æ±‚åœºæ™¯ | æ¨èç»„ä»¶ | è¯´æ˜ |
|----------|----------|------|
| ç®€å• Modbus é€šä¿¡ | `ModbusManager` | åŸºç¡€åŠŸèƒ½ï¼Œæ˜“äºä½¿ç”¨ |
| é«˜é¢‘æ•°æ®è¯»å– | `OptimizedModbusManager` | åŒ…å«ç¼“å­˜å’Œè¿æ¥æ± ä¼˜åŒ– |
| æ‰¹é‡æ•°æ®å¤„ç† | `ModbusRwManager` | æä¾›æ‰¹é‡æ“ä½œå’Œé™æ€å·¥å…· |
| æ€§èƒ½è¦æ±‚æé«˜ | `modbus_performance.h` ç»„ä»¶ | å¯å•ç‹¬ä½¿ç”¨å„ç§æ€§èƒ½ä¼˜åŒ–ç»„ä»¶ |
| å¼€å‘è°ƒè¯•é˜¶æ®µ | è¯Šæ–­åŠŸèƒ½ | ä½¿ç”¨ä¸²å£è¯Šæ–­å’Œæ€§èƒ½ç›‘æ§å·¥å…· |

### å¼€å‘æµç¨‹å»ºè®®

1. **éœ€æ±‚åˆ†æ**ï¼šç¡®å®šé€šä¿¡åè®®ï¼ˆRTU/TCPï¼‰å’Œæ€§èƒ½è¦æ±‚
2. **ç»„ä»¶é€‰æ‹©**ï¼šæ ¹æ®éœ€æ±‚é€‰æ‹©åˆé€‚çš„ç®¡ç†å™¨ç»„ä»¶
3. **è¿æ¥é…ç½®**ï¼šé…ç½®è¿æ¥å‚æ•°å’Œä¼˜åŒ–é€‰é¡¹
4. **åŠŸèƒ½å®ç°**ï¼šå®ç°å…·ä½“çš„æ•°æ®è¯»å†™é€»è¾‘
5. **æµ‹è¯•è°ƒè¯•**ï¼šä½¿ç”¨è¯Šæ–­å·¥å…·è¿›è¡Œæµ‹è¯•å’Œè°ƒè¯•
6. **æ€§èƒ½ä¼˜åŒ–**ï¼šæ ¹æ®æ€§èƒ½ç›‘æ§ç»“æœè¿›è¡Œä¼˜åŒ–
7. **éƒ¨ç½²ä¸Šçº¿**ï¼šé…ç½®ç”Ÿäº§ç¯å¢ƒå‚æ•°

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

| é—®é¢˜ | å¯èƒ½åŸå›  | è§£å†³æ–¹æ¡ˆ |
|------|----------|----------|
| è¿æ¥å¤±è´¥ | ä¸²å£è¢«å ç”¨ã€å‚æ•°é”™è¯¯ | ä½¿ç”¨è¯Šæ–­å·¥å…·æ£€æŸ¥ä¸²å£çŠ¶æ€ |
| è¯»å†™è¶…æ—¶ | ç½‘ç»œå»¶è¿Ÿã€è®¾å¤‡æ— å“åº” | å¢åŠ è¶…æ—¶æ—¶é—´ï¼Œæ£€æŸ¥è®¾å¤‡çŠ¶æ€ |
| æ€§èƒ½è¾ƒå·® | é¢‘ç¹è¿æ¥ã€æ— ç¼“å­˜ | å¯ç”¨è¿æ¥æ± å’Œç¼“å­˜ä¼˜åŒ– |
| å†…å­˜æ³„éœ² | æœªé‡Šæ”¾èµ„æº | å®šæœŸè°ƒç”¨æ¸…ç†å‡½æ•° |

### è°ƒè¯•å·¥å…·

```cpp
// å¯ç”¨è°ƒè¯•æ¨¡å¼
manager->setDebugMode(true);

// ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š
QString report = ModbusManager::generateDiagnosticReport();

// è·å–æ€§èƒ½ç»Ÿè®¡
QMap<QString, QVariant> stats = optimizedManager->getPerformanceStats();

// ç³»ç»Ÿå¥åº·æ£€æŸ¥
QMap<QString, QVariant> health = optimizedManager->getSystemHealth();
```

## ğŸ“ æœ€ä½³å®è·µ

### 1. é”™è¯¯å¤„ç†
```cpp
// å§‹ç»ˆæ£€æŸ¥æ“ä½œç»“æœ
bool success = manager->readHoldingRegisters(0, 10, values);
if (!success) {
    QString error = manager->getLastError();
    qWarning() << "è¯»å–å¤±è´¥ï¼š" << error;
    // å¤„ç†é”™è¯¯...
}
```

### 2. èµ„æºç®¡ç†
```cpp
// ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆç®¡ç†èµ„æº
std::unique_ptr<ModbusManager> manager(new ModbusManager());

// æˆ–ä½¿ç”¨ Qt çš„çˆ¶å­å¯¹è±¡ç®¡ç†
ModbusManager* manager = new ModbusManager(this);
```

### 3. æ€§èƒ½ä¼˜åŒ–
```cpp
// é«˜é¢‘è¯»å–åœºæ™¯ä½¿ç”¨ç¼“å­˜
OptimizedModbusManager::OptimizationConfig config;
config.cacheEnabled = true;
config.defaultCacheTtlMs = 1000;
optimizedManager->setOptimizationConfig(config);
```

### 4. ä¿¡å·æ§½è¿æ¥
```cpp
// ç›‘å¬è¿æ¥çŠ¶æ€å˜åŒ–
connect(manager, &ModbusManager::connected, this, &MyClass::onConnected);
connect(manager, &ModbusManager::disconnected, this, &MyClass::onDisconnected);
connect(manager, &ModbusManager::errorOccurred, this, &MyClass::onError);
```

## ğŸ¤ æŠ€æœ¯æ”¯æŒ

### æ–‡æ¡£åé¦ˆ
å¦‚æœæ‚¨åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­å‘ç°æ–‡æ¡£é—®é¢˜æˆ–æœ‰æ”¹è¿›å»ºè®®ï¼Œè¯·ï¼š
1. æ£€æŸ¥ç›¸å…³æ–‡æ¡£æ˜¯å¦æœ‰æ›´æ–°
2. æŸ¥çœ‹ç¤ºä¾‹ä»£ç å’Œæœ€ä½³å®è·µ
3. å‚è€ƒæ•…éšœæ’é™¤æŒ‡å—

### å¼€å‘æ”¯æŒ
- è¯¦ç»†çš„ API æ–‡æ¡£å’Œä½¿ç”¨ç¤ºä¾‹
- å®Œæ•´çš„æ•…éšœæ’é™¤æŒ‡å—
- æ€§èƒ½ä¼˜åŒ–å»ºè®®å’Œé…ç½®æŒ‡å—

## ğŸ“„ ç‰ˆæœ¬ä¿¡æ¯

å½“å‰æ–‡æ¡£ç‰ˆæœ¬å¯¹åº”çš„åº“ç‰ˆæœ¬ä¿¡æ¯è¯·å‚è€ƒ [modbus-version.md](modbus-version.md)ã€‚

---

**æ›´æ–°æ—¶é—´**: 2025-06-07  
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0.0  
**ç»´æŠ¤çŠ¶æ€**: æ´»è·ƒç»´æŠ¤ä¸­ âœ…
